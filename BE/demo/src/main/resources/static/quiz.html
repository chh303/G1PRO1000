<!DOCTYPE html>
<html lang="no">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Quiz: Gr√∏nn Koding</title>

  <link rel="stylesheet" href="css/quiz.css" />
  <link rel="stylesheet" href="css/header.css" />
  <link rel="stylesheet" href="css/footer.css" />
  <link rel="stylesheet" href="css/chatbot.css" />
  <script src="/script/header.js" defer></script>
  <script src="/script/footer.js" defer></script>
  <script src="/script/chatbot.js" defer></script>
  <link rel="icon" href="/images/favicon.ico" type="image/x-icon" />
</head>
<body class="quiz-body" id="quiz-page" data-page="quiz.html">
  <div class="quiz-layout">
    <nav class="quiz-sidebar">
      <ul>
        <li><a href="#gronnkode">Gr√∏nn kode</a></li>
        <li><a href="#energibruk">Energibruk</a></li>
        <li><a href="#effektivitet">Effektivitet</a></li>
        <li><a href="#designvalg">Designvalg</a></li>
      </ul>
    </nav>

    <main class="quiz-content">
      <section class="quiz-intro">
        <h1>Quiz: Gr√∏nn Koding</h1>
        <p>Test kunnskapen din innen b√¶rekraftig programmering og gr√∏nn teknologi.</p>
      </section>

      <section class="quiz-article" id="gronnkode">
        <h2>Gr√∏nn kode</h2>
        <div id="quiz-container">
          <div id="score-popup" class="score-popup">+50</div>
          <p id="quiz-question"></p>
          <div id="quiz-options"></div>
          <p id="quiz-feedback"></p>
          <button id="quiz-nextBtn" style="display:none;" onclick="nextQuestion()">Neste</button>
        </div>
      </section>

      <section class="quiz-article" id="energibruk">
        <h2>Energibruk</h2>
        <div id="energibruk-quiz-container"></div>
      </section>
      
      <section class="quiz-article" id="effektivitet">
        <h2>Kodeeffektivitet</h2>
        <div id="effektivitet-quiz-container"></div>
      </section>
      
      <section class="quiz-article" id="designvalg">
        <h2>Designvalg</h2>
        <div id="designvalg-quiz-container"></div>
      </section>
      
      
    </main>
  </div>

  <div id="chatbot-placeholder"></div>

  <script>
    /*GR√òNN KODE QUIZ SP√òRSM√ÖL*/
    const quizData = [
      {
        question: "Hva handler gr√∏nn kode hovedsakelig om?",
        options: [
          "√Ö bruke mange farger i design",
          "√Ö skrive kode med mindre str√∏mforbruk",
          "√Ö bruke nyeste teknologi",
          "√Ö kode kun for gr√∏nne bedrifter"
        ],
        correct: "√Ö skrive kode med mindre str√∏mforbruk"
      },
      {
        question: "Hvilket tiltak bidrar mest til energieffektiv frontend?",
        options: [
          "Bruk av store bakgrunnsbilder",
          "Animasjoner i h√∏y oppl√∏sning",
          "Lazy loading av bilder og innhold",
          "Autoplay av videoer"
        ],
        correct: "Lazy loading av bilder og innhold"
      },
      {
        question: "Hva kan du gj√∏re i backend for √• redusere milj√∏avtrykket?",
        options: [
          "√òke antall serverkall",
          "Bruke polling i stedet for events",
          "Cache ofte brukte data",
          "Bruke st√∏rre databaser"
        ],
        correct: "Cache ofte brukte data"
      },
      {
        question: "Hvilken teknologi er kjent for √• bruke fornybar energi i sine datasentre?",
        options: [
          "AWS",
          "Google Cloud",
          "DigitalOcean",
          "GitHub"
        ],
        correct: "Google Cloud"
      },
      {
        question: "Hvilket av disse prinsippene er IKKE en del av gr√∏nn koding?",
        options: [
          "Redusere dataoverf√∏ring",
          "Optimalisere algoritmer",
          "Bruke s√• mye RAM som mulig",
          "Minimere lastetid"
        ],
        correct: "Bruke s√• mye RAM som mulig"
      }
    ];
/*------------------------------------------------------------------------------------------------------------*/
/*SCRIPT OG SP√òRSM√ÖL TIL ENERGIBRUK*/
const energibrukData = [
    {
      question: "Hva bruker mest energi i en nettside?",
      options: ["Store bilder og videoer", "Enkel tekst", "Fargerike knapper", "Responsiv design"],
      correct: "Store bilder og videoer"
    },
    {
      question: "Hva kan redusere str√∏mforbruket i UI?",
      options: ["Bruk av m√∏rk modus", "Flere fonter", "GIF-animasjoner", "Video i bakgrunnen"],
      correct: "Bruk av m√∏rk modus"
    },
    {
      question: "Hva er energibesparende?",
      options: ["Komprimere bilder", "Bruke store JavaScript-bibliotek", "Autoplay av video", "Lysmodus alltid"],
      correct: "Komprimere bilder"
    },
    {
      question: "Hva f√∏rer til un√∏dvendig str√∏mforbruk?",
      options: ["Tung animasjon", "Systemfonter", "Minifisert CSS", "SVG-ikoner"],
      correct: "Tung animasjon"
    },
    {
      question: "Hva reduserer overf√∏ring og str√∏mforbruk?",
      options: ["Lazy loading", "Inline CSS", "Store logoer", "Store skrifttyper"],
      correct: "Lazy loading"
    }
  ];

  let energibrukIndex = 0;

  function loadEnergibrukQuestion() {
    const container = document.getElementById("energibruk-quiz-container");
    const q = energibrukData[energibrukIndex];

    container.innerHTML = `
      <div class="quiz-container">
        <h3>${q.question}</h3>
        <div class="quiz-options">
          ${q.options.map(option =>
            `<button class="quiz-option-btn" onclick="checkEnergibrukAnswer(this, '${q.correct.replace(/'/g, "\\'")}')">${option}</button>`
          ).join("")}
        </div>
        <p id="energibruk-feedback" class="quiz-feedback"></p>
        <button id="energibruk-nextBtn" style="display:none;" onclick="nextEnergibrukQuestion()">Neste</button>
      </div>
    `;
  }

  async function checkEnergibrukAnswer(button, correctAnswer) {
    const buttons = document.querySelectorAll("#energibruk-quiz-container .quiz-option-btn");
    const feedback = document.getElementById("energibruk-feedback");
    const nextBtn = document.getElementById("energibruk-nextBtn");

    buttons.forEach(btn => btn.disabled = true);

    if (button.innerText === correctAnswer) {
      feedback.textContent = "Riktig! üéâ";
      feedback.style.color = "green";
      await increaseScore(); // Samme funksjon som i gronnkode
    } else {
      feedback.textContent = "Feil! ‚ùå";
      feedback.style.color = "red";
    }

    nextBtn.style.display = "inline-block";
  }

  function nextEnergibrukQuestion() {
    energibrukIndex++;
    if (energibrukIndex < energibrukData.length) {
      loadEnergibrukQuestion();
    } else {
      document.getElementById("energibruk-quiz-container").innerHTML = "<h3>Du har fullf√∏rt Energibruk-quizen! üéâ</h3>";
    }
  }

  // Kj√∏r n√•r man g√•r til #energibruk
  document.addEventListener("DOMContentLoaded", () => {
    if (location.hash === "#energibruk") {
      loadEnergibrukQuestion();
    }

    // Last quizen p√• nytt ved manuell hash-endring
    window.addEventListener("hashchange", () => {
      if (location.hash === "#energibruk") {
        energibrukIndex = 0;
        loadEnergibrukQuestion();
      }
    });
  });
/*------------------------------------------------------------------------------------------------------------*/
/*SCRIPT OG SP√òRSM√ÖL TIL EFFEKTIVITET*/
const effektivitetData = [
  {
    question: "Hva er en god praksis for effektiv looping?",
    options: ["Bruke nested loops alltid", "Foretrekke while fremfor for", "Unng√• un√∏dvendige gjentakelser", "Iterere med rekursjon uansett"],
    correct: "Unng√• un√∏dvendige gjentakelser"
  },
  {
    question: "Hva bidrar til bedre ytelse i datastrukturer?",
    options: ["Bruke ArrayList for alt", "Velge struktur basert p√• bruk", "Alltid bruke HashMap", "Unng√• datastrukturer"],
    correct: "Velge struktur basert p√• bruk"
  },
  {
    question: "Hvordan b√∏r man behandle store datamengder?",
    options: ["Bruke √©n stor l√∏kke", "Lagre alt i minnet", "Batch-prosessere", "Gjenta sp√∏rringer konstant"],
    correct: "Batch-prosessere"
  },
  {
    question: "Hva er best for ytelse?",
    options: ["√Ö logge alt", "Korte funksjoner", "Tung logging i produksjon", "Unng√• refaktorering"],
    correct: "Korte funksjoner"
  },
  {
    question: "Hva er et tegn p√• ineffektiv kode?",
    options: ["Kode med kommentarer", "Gjentatt logikk", "Enkle funksjoner", "Gjenbrukbar kode"],
    correct: "Gjentatt logikk"
  }
];

let effektivitetIndex = 0;

function loadEffektivitetQuestion() {
  const container = document.getElementById("effektivitet-quiz-container");
  const q = effektivitetData[effektivitetIndex];

  container.innerHTML = `
    <div class="quiz-container">
      <h3>${q.question}</h3>
      <div class="quiz-options">
        ${q.options.map(option =>
          `<button class="quiz-option-btn" onclick="checkEffektivitetAnswer(this, '${q.correct.replace(/'/g, "\\'")}')">${option}</button>`
        ).join("")}
      </div>
      <p id="effektivitet-feedback" class="quiz-feedback"></p>
      <button id="effektivitet-nextBtn" style="display:none;" onclick="nextEffektivitetQuestion()">Neste</button>
    </div>
  `;
}

async function checkEffektivitetAnswer(button, correctAnswer) {
  const buttons = document.querySelectorAll("#effektivitet-quiz-container .quiz-option-btn");
  const feedback = document.getElementById("effektivitet-feedback");
  const nextBtn = document.getElementById("effektivitet-nextBtn");

  buttons.forEach(btn => btn.disabled = true);

  if (button.innerText === correctAnswer) {
    feedback.textContent = "Riktig! üéâ";
    feedback.style.color = "green";
    await increaseScore();
  } else {
    feedback.textContent = "Feil! ‚ùå";
    feedback.style.color = "red";
  }

  nextBtn.style.display = "inline-block";
}

function nextEffektivitetQuestion() {
  effektivitetIndex++;
  if (effektivitetIndex < effektivitetData.length) {
    loadEffektivitetQuestion();
  } else {
    document.getElementById("effektivitet-quiz-container").innerHTML = "<h3>Du har fullf√∏rt Effektivitets-quizen! üéâ</h3>";
  }
}

/*------------------------------------------------------------------------------------------------------------*/
/*SCRIPT OG SP√òRSM√ÖL TIL DESIGNVALG*/
const designvalgData = [
  {
    question: "Hva er viktig i b√¶rekraftig design?",
    options: ["Bruk av mange fonter", "Minimalistisk layout", "Store bilder", "Animerte bakgrunner"],
    correct: "Minimalistisk layout"
  },
  {
    question: "Hva reduserer energibruk i UI-design?",
    options: ["Video i bakgrunnen", "Dynamisk lastet innhold", "Flash-elementer", "Ukomprimert grafikk"],
    correct: "Dynamisk lastet innhold"
  },
  {
    question: "Hvordan p√•virker farger str√∏mforbruk?",
    options: ["Lyse farger bruker mindre", "M√∏rk modus kan spare str√∏m", "Farger p√•virker ikke", "Flerfarget bakgrunn er best"],
    correct: "M√∏rk modus kan spare str√∏m"
  },
  {
    question: "Hva er best praksis for bruk av media?",
    options: ["HD-videoer automatisk", "Kompakte bilder og SVG", "GIF-er som bakgrunn", "Fullskjerm-animasjoner"],
    correct: "Kompakte bilder og SVG"
  },
  {
    question: "Hva er en ulempe med overkomplisert UI?",
    options: ["Det bruker mindre b√•ndbredde", "Det er raskere √• utvikle", "Det krever mer energi", "Det er enklere √• forst√•"],
    correct: "Det krever mer energi"
  }
];

let designvalgIndex = 0;

function loadDesignvalgQuestion() {
  const container = document.getElementById("designvalg-quiz-container");
  const q = designvalgData[designvalgIndex];

  container.innerHTML = `
    <div class="quiz-container">
      <h3>${q.question}</h3>
      <div class="quiz-options">
        ${q.options.map(option =>
          `<button class="quiz-option-btn" onclick="checkDesignvalgAnswer(this, '${q.correct.replace(/'/g, "\\'")}')">${option}</button>`
        ).join("")}
      </div>
      <p id="designvalg-feedback" class="quiz-feedback"></p>
      <button id="designvalg-nextBtn" style="display:none;" onclick="nextDesignvalgQuestion()">Neste</button>
    </div>
  `;
}

async function checkDesignvalgAnswer(button, correctAnswer) {
  const buttons = document.querySelectorAll("#designvalg-quiz-container .quiz-option-btn");
  const feedback = document.getElementById("designvalg-feedback");
  const nextBtn = document.getElementById("designvalg-nextBtn");

  buttons.forEach(btn => btn.disabled = true);

  if (button.innerText === correctAnswer) {
    feedback.textContent = "Riktig! üéâ";
    feedback.style.color = "green";
    await increaseScore();
  } else {
    feedback.textContent = "Feil! ‚ùå";
    feedback.style.color = "red";
  }

  nextBtn.style.display = "inline-block";
}

function nextDesignvalgQuestion() {
  designvalgIndex++;
  if (designvalgIndex < designvalgData.length) {
    loadDesignvalgQuestion();
  } else {
    document.getElementById("designvalg-quiz-container").innerHTML = "<h3>Du har fullf√∏rt Designvalg-quizen! üéâ</h3>";
  }
}

/*------------------------------------------------------------------------------------------------------------*/

    let currentQuestionIndex = 0;
    let answered = false;
    let loggedInUserId = null;

    async function checkSession() {
      try {
        const response = await fetch("/api/users/session", {
          method: "GET",
          credentials: "include"
        });

        if (!response.ok) throw new Error("Ikke innlogget");

        const data = await response.json();
        loggedInUserId = data.userId;
      } catch (err) {
        alert("Du m√• v√¶re logget inn for √• ta quizen.");
        window.location.href = "login.html";
      }
    }

    async function loadQuestion() {
      answered = false;
      const questionEl = document.getElementById("quiz-question");
      const optionsEl = document.getElementById("quiz-options");
      const feedbackEl = document.getElementById("quiz-feedback");
      const nextBtn = document.getElementById("quiz-nextBtn");

      feedbackEl.textContent = "";
      nextBtn.style.display = "none";

      const questionData = quizData[currentQuestionIndex];
      questionEl.textContent = questionData.question;
      optionsEl.innerHTML = "";

      questionData.options.forEach(option => {
        const button = document.createElement("button");
        button.textContent = option;
        button.classList.add("quiz-option-btn");
        button.onclick = () => checkAnswer(button, questionData.correct);
        optionsEl.appendChild(button);
      });
    }

    async function checkAnswer(button, correctAnswer) {
      if (answered) return;
      answered = true;

      const feedback = document.getElementById("quiz-feedback");
      const nextBtn = document.getElementById("quiz-nextBtn");
      const buttons = document.querySelectorAll("#quiz-options button");

      buttons.forEach(btn => btn.disabled = true);

      if (button.innerText === correctAnswer) {
        feedback.textContent = "Riktig! üéâ";
        feedback.style.color = "green";
        showScorePopup();
        await increaseScore();
      } else {
        feedback.textContent = "Feil! ‚ùå";
        feedback.style.color = "red";
      }

      nextBtn.style.display = "block";
    }

    async function increaseScore() {
      try {
        const response = await fetch("/api/score/update", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          credentials: "include",
          body: JSON.stringify({
            userId: loggedInUserId,
            score: 50,
            achievements: ["Quiz Bonus"]
          })
        });

        if (!response.ok) {
          console.error("‚ùå Kunne ikke oppdatere score");
        }
      } catch (err) {
        console.error("‚ö†Ô∏è Feil under poengoppdatering:", err);
      }
    }

    function nextQuestion() {
      currentQuestionIndex++;
      if (currentQuestionIndex < quizData.length) {
        loadQuestion();
      } else {
        document.getElementById("quiz-container").innerHTML = "<h2>Gratulerer, du har fullf√∏rt quizen! üéâ</h2>";
      }
    }

    function showScorePopup() {
      const popup = document.getElementById("score-popup");
      popup.classList.add("show");
      setTimeout(() => {
        popup.classList.remove("show");
      }, 500);
    }

    checkSession().then(loadQuestion);

    document.addEventListener("DOMContentLoaded", () => {
  const sidebarLinks = document.querySelectorAll(".quiz-sidebar a");

  sidebarLinks.forEach(link => {
    link.addEventListener("click", (e) => {
      e.preventDefault();
      const targetId = link.getAttribute("href").substring(1);
      history.replaceState(null, "", `#${targetId}`);
      document.querySelectorAll(".quiz-article").forEach(section => {
        section.style.display = "none";
      });
      const targetSection = document.getElementById(targetId);
      if (targetSection) {
        targetSection.style.display = "block";

        if (targetId === "energibruk") {
          energibrukIndex = 0;
          loadEnergibrukQuestion();
        }
        if (targetId === "gronnkode") {
          currentQuestionIndex = 0;
          loadQuestion();
        }
        if (targetId === "effektivitet") {
          effektivitetIndex = 0;
          loadEffektivitetQuestion();
        }
        if (targetId === "designvalg") {
          designvalgIndex = 0;
          loadDesignvalgQuestion();
        }
      }
    });
  });

  // Last inn seksjonen som matcher URL-hash ved f√∏rste last
  if (location.hash === "#energibruk") loadEnergibrukQuestion();
  else if (location.hash === "#effektivitet") loadEffektivitetQuestion();
  else if (location.hash === "#designvalg") loadDesignvalgQuestion();
  else loadQuestion(); // default
});

  </script>
</body>
</html>
